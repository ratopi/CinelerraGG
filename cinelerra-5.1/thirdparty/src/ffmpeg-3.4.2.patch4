diff -ur a/libavcodec/libx264.c b/libavcodec/libx264.c
--- a/libavcodec/libx264.c	2018-02-11 17:29:18.000000000 -0700
+++ b/libavcodec/libx264.c	2018-03-13 09:38:03.241861794 -0600
@@ -280,7 +280,11 @@
 
     x264_picture_init( &x4->pic );
     x4->pic.img.i_csp   = x4->params.i_csp;
-    if (desc->comp[0].depth > 8)
+#if X264_BUILD >= 153
+    if (x4->params.i_bitdepth > 8)
+#else
+    if (x264_bit_depth > 8)
+#endif
         x4->pic.img.i_csp |= X264_CSP_HIGH_DEPTH;
     x4->pic.img.i_plane = avfmt2_num_planes(ctx->pix_fmt);
 
